<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Perfect Notion</title>
  <script type="module" src="./src/main.js"></script>
</head>
<body>
  <div id="app">
  </div>
  <script>
    const userName = 'jiinyy';
    function ์งํ์_๋ฌธ์_๊ฐ์ธ์ค๊ธฐ() {
      return fetch("https://kdt-frontend.programmers.co.kr/documents", {
        headers: { 'x-username': userName }
      }).then((response) => response.json());
    }

    function ์งํ์_๋ธ์์_์๋ก์ด_๋ฌธ์_์ถ๊ฐ(title) {
      return fetch("https://kdt-frontend.programmers.co.kr/documents", {
        method: 'POST',
        // request body
        body: JSON.stringify({
          title,
          parent: null
        }),
        headers: {
          "Content-Type": "application/json",
          'x-username': userName,
        },
      })
      .then((res) => res.json())
    }

    function ์งํ์_๋ธ์์์_๋ฌธ์_์ญ์(id) {
      return fetch(`https://kdt-frontend.programmers.co.kr/documents/${id}`, {
        method: 'DELETE',
        headers: {
          'x-username': userName,
        },
      })
      .then((res) => res.json())
    }

    function ์งํ์_๋ฌธ์_๊ทธ๋ค์ฃผ๊ธฐ(docs) {
      const addClassName = 'add';
      const deleteClassName = 'delete';
      const inputClassName = 'input';

      document.body.innerHTML = `
        <main>
          ๋ฌธ์์ ์ด ๊ฐฏ์: ${docs.length}

          <input class="${inputClassName}" value="" />
          <button class="${addClassName}">๋ฌธ์๋ฅผ ์ถ๊ฐํ๊ณ ์ถ์ด์</button>

          <ul>
            ${docs.map(({ id, title }) => `
              <li data-id="${id}">
                <span>${title}</span>
                <button class="${deleteClassName}" style="border: none; background: none; cursor: pointer">๐ต</button>
              </li>
            `).join('')}
          </ul>
        </main>
      `;

      document.querySelector(`.${addClassName}`).addEventListener('click', () => {
        const title = document.querySelector(`.${inputClassName}`).value || "๊ธฐ๋ณธ ํ์ดํ์ ๋๋ฌด ์ด๋ต๋ค";
        ์งํ์_๋ธ์์_์๋ก์ด_๋ฌธ์_์ถ๊ฐ(title).then(() => ๋ฌธ์๋ฅผ_๊ฐ์ธ์์_๊ทธ๋ค์ค())
      });

      document.querySelectorAll(`.${deleteClassName}`).forEach(($deleteButton) => {
        $deleteButton.addEventListener('click', ({ target }) => {
          const id = target.closest('[data-id]').dataset.id;
          ์งํ์_๋ธ์์์_๋ฌธ์_์ญ์(id).then(() => ๋ฌธ์๋ฅผ_๊ฐ์ธ์์_๊ทธ๋ค์ค())
        });
      })
    }

    function ๋ฌธ์๋ฅผ_๊ฐ์ธ์์_๊ทธ๋ค์ค() {
      ์งํ์_๋ฌธ์_๊ฐ์ธ์ค๊ธฐ().then(์งํ์_๋ฌธ์_๊ทธ๋ค์ฃผ๊ธฐ);
    }

    ๋ฌธ์๋ฅผ_๊ฐ์ธ์์_๊ทธ๋ค์ค();

    
  </script>
</body>
</html>